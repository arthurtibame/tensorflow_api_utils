# Tensorflow Object detection api usage


```cmd
git clone https://github.com/arthurtibame/tensorflow_api_utils.git
```
---
```cmd
cd tensorflow_api_utils
```
---

```cmd
git clone https://github.com/tensorflow/models.git
```
---
## Create a new python env
```
python -m vnev tf_training
source tf_training/bin/activate
python -m pip install pip --upgrade
```
## Prepare protobuf
```cmd
sudo apt-get update && sudo apt-get install -y \
    git \
    gpg-agent \
    python3-cairocffi \
    protobuf-compiler \
    python3-pil \
    python3-lxml \
    python3-tk \
    wget
```
## Generate Protobuf converter
```cmd
cd models/research
protoc object_detection/protos/*.proto --python_out=.
```
## install python packages
```
cp object_detection/packages/tf2/setup.py .
python -m pip install .
```

## data preparation
- For the flag, model, please check the available models in [here](https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md)

- If there are some modified please add new links in [here](https://github.com/arthurtibame/tensorflow_api_utils/blob/main/utils/models.json)

- The outputs are train.tfrecord, test.tfrecord, customized pipeline.config, automated download pretrained model

```cmd
cd ../../
python merge_tfrecord.py \
	--path <tfrecord path> \
	--batch_size <default 16> \
	--num_steps <default 25000> \
	--num_classes <default 1> \
	--model <the avaiable pretrained models>

```
## Start Training

### Introduction of parametres (for more details please check [here](https://github.com/tensorflow/models/blob/master/research/object_detection/model_main_tf2.py)
- 'pipeline_config_path': The pipeline.config file which just generated by "merge_tfrecord.py"
- 'model_dir': The path of output checkpoint path
- 'alsologtostderr'

```cmd
cd models/research
python objection_detection/model_main_tf2.py \
	--pipeline_config_path=../../export_dataset/pipeline.config \
	--model_dir=../../export_dataset/ckpt \ 
	--alsologtostderr
```

## Convert checkpoint to .pb (inference model)

```cmd
python object_detection/export_tflite_graph_tf2.py \
	--pipeline_config_path=$PIPELINE_CONFIG_PATH \
	--trained_checkpoint_dir=$TRAINED_CHECKPOINT_DIR  \
	--output_directory=$OUTPUT_DIRECTORY
```

## Convert .pb to .tflite (FP32) [PLEASE USER tf-nighlt-gpu version of tensorflow]
```cmd
tflite_convert --saved_model_dir=$OUTPUT_DIRECTORY/saved_model --output_file=$OUTPUT_DIRECTORY/detect.tflite
```



